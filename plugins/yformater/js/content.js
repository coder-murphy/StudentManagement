var keypressListener=new window.keypress.Listener();chrome.extension.onMessage.addListener(menuFormatHandle);function menuFormatHandle(request,sender,callback){if(request.message.indexOf("yformater-format")==0){if(document.querySelectorAll("pre.yformater-code-container").length>0&&!request.clipboard){return}var formatParams={SINGLE_TAB:"  ",TAB:"  ",ImgCollapsed:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAALCAYAAABs3u23AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkRBRjNGNkM1MDE3MjExRTZCNzM2QkUyNjVDQTVFQzc2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkRBRjNGNkM2MDE3MjExRTZCNzM2QkUyNjVDQTVFQzc2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6REFGM0Y2QzMwMTcyMTFFNkI3MzZCRTI2NUNBNUVDNzYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6REFGM0Y2QzQwMTcyMTFFNkI3MzZCRTI2NUNBNUVDNzYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz44H+yzAAAAb0lEQVR42mL8//8/Az0BI8jCujk7CdralOLOSA0LWZAMxKkI6CCq+ZAJq7cZGWkWpEwMdAYsuHwGY+NLVLC4h8UvIT6GhTDDQZbRLPWCDK6dveM/MoAIIwBUnoEamAmXI2geh9RM+gQzPj0BQIABAE8pgTAkC0ZaAAAAAElFTkSuQmCC",ImgExpanded:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAALCAYAAABs3u23AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjhDRjFGMzFDMDE3MjExRTY5QTJFQTcyNzQxNDgzOUFFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjhDRjFGMzFEMDE3MjExRTY5QTJFQTcyNzQxNDgzOUFFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6OENGMUYzMUEwMTcyMTFFNjlBMkVBNzI3NDE0ODM5QUUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6OENGMUYzMUIwMTcyMTFFNjlBMkVBNzI3NDE0ODM5QUUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5nnkg4AAAASklEQVR42mL8//8/Az0BC4iom7OToK1NKe6MVLMQaiBORUAHUc2HTAx0BnS3kAWZw8iIGU3UTlQstDR8hMchNZM+PsBI75IGIMAAo8cU6RxITt4AAAAASUVORK5CYII=",QuoteKeys:true,IsCollapsible:false};formatParams.IsCollapsible=request.control;function $id(id){return document.getElementById(id)}function IsArray(obj){return obj&&typeof obj==="object"&&typeof obj.length==="number"&&!(obj.propertyIsEnumerable("length"))}function Process(json){var html="",matcher,callName=null;try{if(!json){json='""'}if(/\)\s*;*\s*$/.test(json)){matcher=/^\s*([a-zA-Z$_][0-9a-zA-Z$_]*)\s*\(/.exec(json);callName=matcher&&matcher[1];if(callName){window[callName]=function(data){formatParams.json=[];formatParams.json.push(data)};eval(json)}}if(!formatParams.json){matcher=/^\s*var\s+([a-zA-Z$_][0-9a-zA-Z$_]*)\s*=\s*/.exec(json);callName=matcher&&matcher[1];if(callName){window.eval(json);formatParams.json=[];formatParams.json.push(window[callName])}}if(!formatParams.json){formatParams.json=eval("["+json+"]")}formatParams.maxLevel=0;html=ProcessObject(formatParams.json[0],0,false,false,false);formatParams.maxLevel=formatParams.maxLevel+1;formatParams.level=formatParams.maxLevel;return"<pre class='yformater-code-container "+request.theme+" "+request.font+"'>"+html+"</pre>"+"<ul class='yformater-toolbar' style='display:"+(formatParams.IsCollapsible?"none":"block")+";'>"+"<li class='event-show-control'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_show_control")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"</ul>"+"<ul class='yformater-toolbar move' style='display:"+(formatParams.IsCollapsible?"block":"none")+";'>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_all")+"' class='event-expand-all'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_all")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_collapse_all")+"' class='event-collapse-all'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_collapse_all")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_prev")+"' class='event-expand-prev'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_prev")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_next")+"' class='event-expand-next'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_next")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_level1")+"' class='event-expand-level' data-level='1'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_level1")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_level2")+"' class='event-expand-level' data-level='2'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_level2")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_level3")+"' class='event-expand-level' data-level='3'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_level3")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_level4")+"' class='event-expand-level' data-level='4'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_level4")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_level5")+"' class='event-expand-level' data-level='5'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_level5")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"<li title='"+chrome.i18n.getMessage("file_content_title_expand_level6")+"' class='event-expand-level' data-level='6'>"+"<div class='toolbar-button'>"+chrome.i18n.getMessage("file_content_expand_level6")+"</div>"+"<div class='ghost top'></div>"+"<div class='ghost right'></div>"+"<div class='ghost bottom'></div>"+"<div class='ghost left'></div>"+"</li>"+"</ul>"
}catch(e){console.warn(chrome.i18n.getMessage("file_content_parse_fail")+"\n"+e.message);Layer.msg.bad(chrome.i18n.getMessage("file_content_parse_fail")+"\n"+e.message,3000);return""}}window._dateObj=new Date();window._regexpObj=new RegExp();function ProcessObject(obj,indent,addComma,isArray,isPropertyContent){var html="";var comma=(addComma)?"<span class='Comma'>,</span> ":"";var type=typeof obj;var clpsHtml="";if(formatParams.maxLevel<indent){formatParams.maxLevel=indent}if(IsArray(obj)){if(obj.length==0){html+=GetRow(indent,"<span class='ArrayBrace'>[</span><span class='ArrayBrace'>]</span>"+comma,isPropertyContent)}else{clpsHtml=formatParams.IsCollapsible?'<span><img src="'+formatParams.ImgExpanded+"\" /></span><span class='collapsible'>":"";html+=GetRow(indent,"<span class='ArrayBrace'>[</span>"+clpsHtml,isPropertyContent);for(var i=0;i<obj.length;i++){html+=ProcessObject(obj[i],indent+1,i<(obj.length-1),true,false)}clpsHtml=formatParams.IsCollapsible?"</span>":"";html+=GetRow(indent,clpsHtml+"<span class='ArrayBrace'>]</span>"+comma)}}else{if(type=="object"){if(obj==null){html+=FormatLiteral("null","",comma,indent,isArray,"Null")}else{if(obj.constructor==window._dateObj.constructor){html+=FormatLiteral("new Date("+obj.getTime()+") /*"+obj.toLocaleString()+"*/","",comma,indent,isArray,"Date")}else{if(obj.constructor==window._regexpObj.constructor){html+=FormatLiteral("new RegExp("+obj+")","",comma,indent,isArray,"RegExp")}else{var numProps=0;for(var prop in obj){numProps++}if(numProps==0){html+=GetRow(indent,"<span class='ObjectBrace'>{ }</span>"+comma,isPropertyContent)}else{clpsHtml=formatParams.IsCollapsible?'<span><img src="'+formatParams.ImgExpanded+"\" /></span><span class='collapsible'>":"";html+=GetRow(indent,"<span class='ObjectBrace'>{</span>"+clpsHtml,isPropertyContent);var j=0;for(var prop in obj){var quote=formatParams.QuoteKeys?'"':"";html+=GetRow(indent+1,"<span class='PropertyName'>"+quote+prop+quote+"</span>: "+ProcessObject(obj[prop],indent+1,++j<numProps,false,true))}clpsHtml=formatParams.IsCollapsible?"</span>":"";html+=GetRow(indent,clpsHtml+"<span class='ObjectBrace'>}</span>"+comma)}}}}}else{if(type=="number"){html+=FormatLiteral(obj,"",comma,indent,isArray,"Number")}else{if(type=="boolean"){html+=FormatLiteral(obj,"",comma,indent,isArray,"Boolean")}else{if(type=="function"){if(obj.constructor==window._regexpObj.constructor){html+=FormatLiteral("new RegExp("+obj+")","",comma,indent,isArray,"RegExp")}else{obj=FormatFunction(indent,obj);html+=FormatLiteral(obj,"",comma,indent,isArray,"Function")}}else{if(type=="undefined"){html+=FormatLiteral("undefined","",comma,indent,isArray,"Null")}else{html+=FormatLiteral(obj.toString().split("\\").join("\\\\").split('"').join('\\"'),'"',comma,indent,isArray,"String")}}}}}}return html}function FormatLiteral(literal,quote,comma,indent,isArray,style){if(typeof literal=="string"){literal=literal.split("<").join("&lt;").split(">").join("&gt;")}var str="<span class='"+style+"'>"+quote+literal+quote+comma+"</span>";if(isArray){str=GetRow(indent,str)}return str}function FormatFunction(indent,obj){var tabs="";for(var i=0;i<indent;i++){tabs+=formatParams.TAB}var funcStrArray=obj.toString().split("\n");var str="";for(var i=0;i<funcStrArray.length;i++){str+=((i==0)?"":tabs)+funcStrArray[i]+"\n"}return str}function GetRow(indent,data,isPropertyContent){var tabs="";for(var i=0;i<indent&&!isPropertyContent;i++){tabs+=formatParams.TAB}if(data!=null&&data.length>0&&data.charAt(data.length-1)!="\n"){data=data+"\n"}return tabs+data}function CollapsibleViewClicked(){$id("CollapsibleViewDetail").style.visibility=$id("CollapsibleView").checked?"visible":"hidden";Process()}function MakeContentVisible(element,visible){var img=element.previousSibling.firstChild;if(!!img.tagName&&img.tagName.toLowerCase()=="img"){element.style.display=visible?"inline":"none";element.previousSibling.firstChild.src=visible?formatParams.ImgExpanded:formatParams.ImgCollapsed}}function TraverseChildren(element,func,depth){for(var i=0;i<element.childNodes.length;i++){TraverseChildren(element.childNodes[i],func,depth+1)}func(element,depth)}function ExpImgClicked(img){var container=img.parentNode.nextSibling;if(!container){return}var disp="none";var src=formatParams.ImgCollapsed;if(container.style.display=="none"){disp="inline";src=formatParams.ImgExpanded}container.style.display=disp;img.src=src}function showControl(){formatParams.IsCollapsible=true;document.body.innerHTML=Process();new Drag(document.querySelector("ul.yformater-toolbar.move")).start();keypressListener.simple_combo("up",function(){formatParams.level=1;CollapseLevel(formatParams.level)});keypressListener.simple_combo("down",function(){formatParams.level=formatParams.maxLevel;ExpandAllClicked()});keypressListener.simple_combo("left",function(){if(formatParams.level>1){formatParams.level=formatParams.level-1;CollapseLevel(formatParams.level)}});keypressListener.simple_combo("right",function(){if(formatParams.level<formatParams.maxLevel){formatParams.level=formatParams.level+1;
CollapseLevel(formatParams.level)}});keypressListener.simple_combo("1",function(){if(formatParams.maxLevel<1){formatParams.level=formatParams.maxLevel;ExpandAllClicked()}else{formatParams.level=1;CollapseLevel(formatParams.level)}});keypressListener.simple_combo("2",function(){if(formatParams.maxLevel<2){formatParams.level=formatParams.maxLevel;ExpandAllClicked()}else{formatParams.level=2;CollapseLevel(formatParams.level)}});keypressListener.simple_combo("3",function(){if(formatParams.maxLevel<3){formatParams.level=formatParams.maxLevel;ExpandAllClicked()}else{formatParams.level=3;CollapseLevel(formatParams.level)}});keypressListener.simple_combo("4",function(){if(formatParams.maxLevel<4){formatParams.level=formatParams.maxLevel;ExpandAllClicked()}else{formatParams.level=4;CollapseLevel(formatParams.level)}});keypressListener.simple_combo("5",function(){if(formatParams.maxLevel<5){formatParams.level=formatParams.maxLevel;ExpandAllClicked()}else{formatParams.level=5;CollapseLevel(formatParams.level)}});keypressListener.simple_combo("6",function(){if(formatParams.maxLevel<6){formatParams.level=formatParams.maxLevel;ExpandAllClicked()}else{formatParams.level=6;CollapseLevel(formatParams.level)}});bindEvent()}function ExpandAllClicked(){TraverseChildren(document.querySelector("pre.yformater-code-container"),function(element){if(element.className=="collapsible"){MakeContentVisible(element,true)}},0)}function CollapseAllClicked(){TraverseChildren(document.querySelector("pre.yformater-code-container"),function(element){if(element.className=="collapsible"){MakeContentVisible(element,false)}},0)}function CollapseLevel(level){TraverseChildren(document.querySelector("pre.yformater-code-container"),function(element,depth){if(element.className=="collapsible"){if(depth>=level){MakeContentVisible(element,false)}else{MakeContentVisible(element,true)}}},0)}function MultiplyString(num,str){var sb=[];for(var i=0;i<num;i++){sb.push(str)}return sb.join("")}function LinkToJson(){var val=$id("RawJson").value;val=escape(val.split("/n").join(" ").split("/r").join(" "));$id("InvisibleLinkUrl").value=val;$id("InvisibleLink").submit()}function bindEvent(){var imgs=document.getElementsByTagName("img"),i=0;for(i=0;i<imgs.length;i++){imgs[i].addEventListener("click",function(e){ExpImgClicked(e.target)},false)}var spans=document.querySelectorAll("span.String,span.PropertyName");for(i=0;i<spans.length;i++){spans[i].addEventListener("click",function(e){var selection=window.getSelection(),textNode=e.target.firstChild,textLength=e.target.innerText.length,childNodeLength=e.target.childNodes.length;if(textLength>childNodeLength){selection.setBaseAndExtent(textNode,1,textNode,textLength-childNodeLength)}},false)}var braces=document.querySelectorAll("span.ArrayBrace,span.ObjectBrace");for(i=0;i<braces.length;i++){braces[i].addEventListener("click",function(e){var s=this,pairs,className,index,braceArray=[],braceStr,offset,target;if(s.className.indexOf(" pair")<0){pairs=document.querySelectorAll("span.pair");for(i=0;i<pairs.length;i++){pairs[i].className=pairs[i].className.replace(" pair","")}for(i=0;i<braces.length;i++){if(braces[i]===s){index=i}}if(s.innerText=="{"||s.innerText=="["){for(i=index+1;i<braces.length;i++){braceArray.push(braces[i].innerText)}}else{for(i=0;i<index;i++){braceArray.push(braces[i].innerText)}}braceStr=braceArray.join("");while(/(\[#*])|({#*})/.test(braceStr)){braceStr=braceStr.replace(/(\[#*])|({#*})/,function(str){return str.replace(/[^#]/g,"").concat("#")})}if(s.innerText=="{"||s.innerText=="["){for(i=0;i<braceStr.length;i++){if(braceStr.charAt(i)!="#"){offset=i*2;break}}target=braces[offset+1+index]}else{for(i=braceStr.length-1;i>=0;i--){if(braceStr.charAt(i)!="#"){offset=braceStr.length-1-i;break}}target=braces[index-1-offset*2]}s.className=s.className.concat(" pair");target.className=target.className.concat(" pair")}e.preventDefault();e.stopPropagation()},false)}document.addEventListener("click",function(e){var pairs=document.querySelectorAll("span.pair");for(i=0;i<pairs.length;i++){pairs[i].className=pairs[i].className.replace(" pair","")}},false);document.querySelector(".event-show-control").addEventListener("click",function(e){showControl()},false);document.querySelector(".event-expand-all").addEventListener("click",function(e){formatParams.level=formatParams.maxLevel;ExpandAllClicked()},false);document.querySelector(".event-expand-all").addEventListener("mousedown",function(e){e.stopPropagation()},false);document.querySelector(".event-collapse-all").addEventListener("click",function(e){formatParams.level=1;CollapseLevel(formatParams.level)},false);document.querySelector(".event-collapse-all").addEventListener("mousedown",function(e){e.stopPropagation()},false);var levels=document.querySelectorAll(".event-expand-level");for(i=0;i<levels.length;i++){levels[i].addEventListener("click",function(e){var level=parseInt(this.dataset.level);if(formatParams.maxLevel<level){formatParams.level=formatParams.maxLevel;ExpandAllClicked()
}else{formatParams.level=level;CollapseLevel(formatParams.level)}},false);levels[i].addEventListener("mousedown",function(e){e.stopPropagation()},false)}document.querySelector(".event-expand-prev").addEventListener("click",function(e){if(formatParams.level>1){formatParams.level=formatParams.level-1;CollapseLevel(formatParams.level)}},false);document.querySelector(".event-expand-prev").addEventListener("mousedown",function(e){e.stopPropagation()},false);document.querySelector(".event-expand-next").addEventListener("click",function(e){if(formatParams.level<formatParams.maxLevel){formatParams.level=formatParams.level+1;CollapseLevel(formatParams.level)}},false);document.querySelector(".event-expand-next").addEventListener("mousedown",function(e){e.stopPropagation()},false)}function loadStyle(path){var style=document.querySelector("#yformater_style");if(style){return}style=document.createElement("link");style.rel="stylesheet";style.type="text/css";style.id="yformater_style";style.href=chrome.extension.getURL(path);(document.head||document.documentElement).appendChild(style)}function fromClipboard(mimetype,callback){document.onpaste=function(event){var data;data=event.clipboardData.getData(mimetype);event.preventDefault();document.onpaste=null;setTimeout(function(){callback.call(null,data)},0)};document.execCommand("paste",false,null)}if(request.clipboard){fromClipboard("text/plain",function(str){var html=Process(str);if(html){document.body.className=request.theme;document.body.innerHTML=html;loadStyle("css/yformater.css");bindEvent()}})}else{(function(){var html=Process(document.body.innerText);if(html){document.body.className=request.theme;document.body.innerHTML=html;loadStyle("css/yformater.css");bindEvent()}})()}}}chrome.extension.onMessage.addListener(function(request,sender,callback){if(request.message=="yformater-link"){function open(url){var a=document.createElement("a");a.target="_blank";a.href=url;a.style="display: none;";document.body.appendChild(a);a.click();document.body.removeChild(a)}if(request.ext.indexOf("/")>=0){open(request.ext)}}});function menuCopyHandle(request,sender,callback){if(request.message=="yformater-copy"){var contentDom=document.querySelector(".yformater-code-container");if(contentDom){copyToClipboard(contentDom.innerText,"text/plain")}}function copyToClipboard(str,mimetype){document.oncopy=function(event){event.clipboardData.setData(mimetype,str);event.preventDefault();document.oncopy=null;Layer.msg.good(chrome.i18n.getMessage("file_content_copy_success"),3000)};document.execCommand("Copy",false,null)}}chrome.extension.onMessage.addListener(menuCopyHandle);chrome.extension.onMessage.addListener(menuLockHandle);function menuLockHandle(request,sender,callback){var lockMap,url,domain;if(request.message=="yformater-lock"){chrome.runtime.sendMessage({message:"local-storage",method:"read",props:["lock","theme","font"]},function(response){lockMap=JSON.parse(response.lock||"{}");url=window.location.origin+window.location.pathname;domain=window.location.origin;if(request.url){if(lockMap[domain]){lockMap[domain]=undefined}lockMap[url]=true;chrome.runtime.sendMessage({message:"local-storage",method:"write",props:{"lock":JSON.stringify(lockMap)}},function(response){})}if(request.domain){if(lockMap[url]){lockMap[url]=undefined}lockMap[domain]=true;chrome.runtime.sendMessage({message:"local-storage",method:"write",props:{"lock":JSON.stringify(lockMap)}},function(response){})}if(request.cancel){lockMap[domain]=undefined;lockMap[url]=undefined;chrome.runtime.sendMessage({message:"local-storage",method:"write",props:{"lock":JSON.stringify(lockMap)}},function(response){})}if(request.lock){if(lockMap[domain]||lockMap[url]){menuFormatHandle({"message":"yformater-format","control":false,"theme":response.theme||"rainbow","font":response.font||"f13"},null,null);chrome.runtime.sendMessage({message:"icon",method:"active",text:lockMap[domain]?"?":"="},function(response){})}}})}}lockCheck();function lockCheck(){menuLockHandle({"message":"yformater-lock","lock":true},null,null)}chrome.runtime.sendMessage({message:"keyboard-shortcut",method:"check",url:window.location.href},function(response){if(response){keypressListener.simple_combo("alt x",function(){chrome.runtime.sendMessage({message:"local-storage",method:"read",props:["theme","font"]},function(response){menuFormatHandle({"message":"yformater-format","control":false,"theme":response.theme||"rainbow","font":response.font||"f13"},null,null)})});keypressListener.simple_combo("alt v",function(){chrome.runtime.sendMessage({message:"local-storage",method:"read",props:["theme","font"]},function(response){menuFormatHandle({"message":"yformater-format","control":false,"clipboard":true,"theme":response.theme||"rainbow","font":response.font||"f13"},null,null)})});keypressListener.simple_combo("alt c",function(){menuCopyHandle({"message":"yformater-copy"},null,null)})}});